<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title>OKR 리스트</title>
  <style>
    :root { --border:#e5e7eb; --bg:#f9fafb; --muted:#6b7280; --ok:#10b981; --text:#111827; }
    body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; }
    .wrap { max-width: 860px; margin: 40px auto; background: #fff; border:1px solid var(--border); border-radius: 16px; padding: 24px; }
    .obj { border:1px solid var(--border); border-radius:12px; padding:16px; margin-bottom:16px; }
    .kr-item { border:1px solid var(--border); border-radius:12px; padding:12px; margin-bottom:10px; background:#fff; transition: background .2s, box-shadow .2s }
    .kr-item.is-checked { background:#ecfdf5; box-shadow:0 0 0 2px #10b98133 inset }
    .toggle-btn { border:1px solid #d1d5db; border-radius:999px; padding:6px 12px; cursor:pointer; background:#fff; }
    .toggle-btn.is-on { border-color:transparent; background:var(--ok); color:#fff; }
    .kr-meta { color: var(--muted); font-size: 12px; }
    .toast { position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#111827; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; pointer-events:none; transition:opacity .2s, transform .2s }
    .toast.show { opacity:1; transform:translateX(-50%) translateY(-6px) }
  </style>
</head>
<body>
<div class="wrap">
  <h1>OKR 리스트</h1>

  <a href="/"><button>메인으로</button></a>
  <a href="/okr/create" style="margin-left: 10px;"><button>새 OKR 작성하기</button></a>

  <div th:each="objective : ${objectives}" class="obj">
    <h2 th:text="${objective.title}">Objective 제목</h2>
    <span th:text="${objective.dDay}" style="margin-left: 10px; font-weight: bold; color: darkgreen;"></span>
    <p th:text="${objective.description}">Objective 설명</p>

    <ul style="list-style:none; padding-left:0;">

      <li class="kr-item"
          th:each="kr : ${objective.keyResults}"
          th:classappend="${kr.checkedToday} ? ' is-checked' : ''"
          th:attr="data-kr-id=${kr.id}">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:12px">
          <div>
            <span th:text="${kr.content}" class="kr-title">Key Result 내용</span>
            <div class="kr-meta">
              주간 <span th:text="${kr.weekCount}">0</span> ·
              월간 <span th:text="${kr.monthCount}">0</span> ·
              연속 <span th:text="${kr.streak}">0</span>일
            </div>
          </div>

          <button class="toggle-btn"
                  th:classappend="${kr.checkedToday} ? ' is-on' : ''"
                  th:attr="aria-pressed=${kr.checkedToday}">
            <span th:text="${kr.checkedToday} ? '완료' : '체크'">체크</span>
          </button>

          <div style="display:flex; gap:8px; margin-left:12px;">
            <a th:href="@{|/okr/kr/${kr.id}|}">
              <button type="button">세부보기</button>
            </a>
            <form th:action="@{/okr/kr/{id}/delete(id=${kr.id})}" method="post"
                  onsubmit="return confirm('이 핵심 결과를 삭제할까요? 연결된 체크 기록도 함께 삭제됩니다.');">
              <button type="submit">삭제</button>
            </form>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- [FIX] 정적 리소스 경로는 /js/... (Spring Boot 기본) -->
<script src="/js/okr-toggle.js"></script>
</body>
</html>